<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Xamarin Android - Running a script after Signing the APK | Infinitespace Studios</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Xamarin Android - Running a script after Signing the APK" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="One of the many requests I see from customers of Xamarin.Android is the ability to “run a script” after the package has been built and signed, or do some process before the build process. Allot of people end up trying to use the CustomCommands which are available in the IDE to do this work, and shy away from getting down and dirty with MSBuild. The thing is, sometimes MSBuild is the only way to get certain things done." />
<meta property="og:description" content="One of the many requests I see from customers of Xamarin.Android is the ability to “run a script” after the package has been built and signed, or do some process before the build process. Allot of people end up trying to use the CustomCommands which are available in the IDE to do this work, and shy away from getting down and dirty with MSBuild. The thing is, sometimes MSBuild is the only way to get certain things done." />
<link rel="canonical" href="http://localhost:4000/general/xamarin-android-runnning-script-after-signing-apk/" />
<meta property="og:url" content="http://localhost:4000/general/xamarin-android-runnning-script-after-signing-apk/" />
<meta property="og:site_name" content="Infinitespace Studios" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2015-08-14T00:00:00+01:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Xamarin Android - Running a script after Signing the APK" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2015-08-14T00:00:00+01:00","datePublished":"2015-08-14T00:00:00+01:00","description":"One of the many requests I see from customers of Xamarin.Android is the ability to “run a script” after the package has been built and signed, or do some process before the build process. Allot of people end up trying to use the CustomCommands which are available in the IDE to do this work, and shy away from getting down and dirty with MSBuild. The thing is, sometimes MSBuild is the only way to get certain things done.","headline":"Xamarin Android - Running a script after Signing the APK","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/general/xamarin-android-runnning-script-after-signing-apk/"},"url":"http://localhost:4000/general/xamarin-android-runnning-script-after-signing-apk/"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Custom head content - add custom meta tags, analytics, etc. here -->

  </head>
  <body>
    <header class="site-header">
      <div class="header-content">
        <a href="/" class="logo-link">
          <img src="/images/issheader.png" alt="Infinitespace Studios" class="site-logo">
          <span class="site-title">Infinitespace Studios</span>
        </a>
        <nav class="main-nav">
          <ul>
            <li><a href="/">Blog</a></li>
            <li><a href="/about">About</a></li>
            <li><a href="/monogame-ports">Ports</a></li>
          </ul>
        </nav>
      </div>
    </header>

    <main class="site-content">
      <div class="container">
        <p>One of the many requests I see from customers of Xamarin.Android is the ability to “<em>run a script”</em> after the package has been built and signed, or do some process before the build process. Allot of people end up trying to use the CustomCommands which are available in the IDE to do this work, and shy away from getting down and dirty with MSBuild. The thing is, sometimes MSBuild is the only way to get certain things done.</p>

<p>Most people already know about the “SignAndroidPackage” target which is available on Xamarin.Android projects. If not basically you can use this target to create a Signed package, most people would use this on a Continuous Integration (CI) server. You can use it like so</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  msbuild MyProject.csproj /t:SignAndroidPackage
</code></pre></div></div>

<p>Note that this target is ONLY available on the .csproj NOT the .sln but that is ok because MSBuild does its just of resolving projects etc and it should build fine. You can also pass in addition parameters to define your KeyStore etc, more information can be found in the excellent <a href="http://developer.xamarin.com/guides/android/deployment,_testing,_and_metrics/publishing_an_application/part_2_-_signing_the_android_application_package/#_Signing_the_APK_">documentation</a> on the subject.</p>

<p>Now we want to run a script after this has been done, Custom Commands can’t be used as they run at the wrong time in the build process, so what do we do? This is where MSBuild targets come in. What we need to do is add a custom MSBuild target which hooks into the build process After the SignAndroidPackage has run.</p>

<p>First thing to do is open the .csproj of your application in your favourite editor and find the last &lt;/Project&gt; element right at the bottom of the file. Next we define a new target just <em>above</em> the &lt;/Project&gt; element like so</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;Target</span> <span class="na">Name=</span><span class="s">"AfterAndroidSignPackage"</span> <span class="na">AfterTargets=</span><span class="s">"SignAndroidPackage"</span><span class="nt">&gt;</span>
   <span class="nt">&lt;Message</span> <span class="na">Text=</span><span class="s">"AfterSignAndroidPackage Target Ran"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/Target&gt;</span>

</code></pre></div></div>

<p>Save the .csproj and then run the command</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  msbuild MyProject.csproj /t:SignAndroidPackage
</code></pre></div></div>

<p>and you should see the text “AfterSignAndroidPackage Target Ran” in the build output.  If not add a /v:d argument to the command line, which switches the MSBuild output to verbose mode. The key thing here is the Target defines the <em>“AfterTargets”</em> attribute which tells MSBuild when to run this script. In this case after the SignAndroidPackage, there is also a <em>“BeforeTargets”</em> attribute which will run a target.. you guessed it.. before the target(s) listed in the attribute.</p>

<p>Now we have a target that will run after the package has been signed. Next this to do is to get it to run our script, for this we can use the MSBuild <a href="https://msdn.microsoft.com/en-us/library/x8zx72cd.aspx">Exec</a> task. One thing to note is that its more than likely that some of your developers are running on Mac as well as Windows so we need to make sure that any command we do run will work on both systems.</p>

<p>Fortunately we have a way of conditionally executing targets using the <a href="https://msdn.microsoft.com/en-us/library/7szfhaft.aspx">Condition</a> attribute. This means we can do something like</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;Exec</span> <span class="na">Condition=</span><span class="s">" '$(OS)' != 'Unix' "</span> <span class="na">Command=</span><span class="s">"dir"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;Exec</span> <span class="na">Condition=</span><span class="s">" '$(OS)' == 'Unix' "</span> <span class="na">Command=</span><span class="s">"ls"</span> <span class="nt">/&gt;</span>

</code></pre></div></div>

<p>this allows us to run separate commands based on the OS we are running (in this case a directory listing). As you can see we can easily extend this to run a batch file or shell script. So the final target would be</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;Target</span> <span class="na">Name=</span><span class="s">"AfterAndroidSignPackage"</span> <span class="na">AfterTargets=</span><span class="s">"SignAndroidPackage"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Exec</span> <span class="na">Condition=</span><span class="s">" '$(OS)' != 'Unix' "</span> <span class="na">Command=</span><span class="s">"dir"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;Exec</span> <span class="na">Condition=</span><span class="s">" '$(OS)' == 'Unix' "</span> <span class="na">Command=</span><span class="s">"ls"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/Target&gt;</span>

</code></pre></div></div>

<p>MSBuild targets can also define Inputs and Outputs which will allow the build engine to decide if it needs to run the target at all. That is something that you can read up on if you are interested in learning more, but for now if you just want to “run a script after the apk is built” this is all you need.</p>

      </div>
    </main>

    <footer class="site-footer">
      <div class="container">
        <p>&copy; 2009-2026 Infinitespace Studios. All rights reserved.</p>
        <div class="social-links">
          <a href="https://github.com/dellis1972" aria-label="GitHub">GitHub</a>
          <a href="https://mastodon.gamedev.place/@infspacestudios" aria-label="Mastodon">Mastodon</a>
        </div>
      </div>
    </footer>
  </body>
</html>